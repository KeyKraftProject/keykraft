<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Keykraft • Client Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
  <main class="max-w-3xl mx-auto p-6">
    <header class="mb-6">
      <h1 id="clientName" class="text-2xl font-semibold">Loading…</h1>
      <p id="property" class="opacity-80 mt-1"></p>
    </header>

    <section class="mb-6">
      <h2 class="text-lg font-semibold mb-2">Status</h2>
      <div id="status" class="p-3 rounded border bg-white">—</div>
    </section>

    <section class="mb-6">
      <h2 class="text-lg font-semibold mb-2">Timeline</h2>
      <ul id="timeline" class="space-y-2"></ul>
    </section>

    <section>
      <h2 class="text-lg font-semibold mb-2">Documents</h2>
      <ul id="documents" class="list-disc pl-6 space-y-1"></ul>
    </section>

    <p id="error" class="mt-8 text-sm text-red-700 hidden"></p>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // 1) Read ?id=… from URL
    const params = new URLSearchParams(location.search);
    const id = params.get("id");
    const errEl = document.getElementById("error");

    if (!id) {
      errEl.textContent = "Missing client id. Try: client.html?id=demo";
      errEl.classList.remove("hidden");
    }

    // 2) Paste your Firebase config here
    const firebaseConfig = {
      apiKey:        "YOUR_API_KEY",
      authDomain:    "YOUR_PROJECT.firebaseapp.com",
      databaseURL:   "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
      projectId:     "YOUR_PROJECT",
      appId:         "YOUR_APP_ID"
    };

    // 3) Init + fetch
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    async function loadClient(clientId){
      try {
        const snapshot = await get(child(ref(db), `clients/${clientId}`));
        if (!snapshot.exists()) {
          throw new Error(`Client "${clientId}" not found.`);
        }
        render(snapshot.val());
      } catch (e) {
        errEl.textContent = e.message;
        errEl.classList.remove("hidden");
      }
    }

    function render(data){
      document.getElementById("clientName").textContent = data.displayName || "Unnamed Client";
      document.getElementById("property").textContent   = data.property    || "";

      document.getElementById("status").textContent     = data.status || "—";

      const tl = document.getElementById("timeline");
      tl.innerHTML = (data.timeline || [])
        .map(t => `<li><span class="font-medium">${t.date}</span> — ${t.label}</li>`)
        .join("");

      const docs = document.getElementById("documents");
      docs.innerHTML = (data.documents || [])
        .map(d => `<li><a class="text-indigo-700 underline" href="${d.url}" target="_blank" rel="noopener">${d.name}</a></li>`)
        .join("");
    }

    if (id) loadClient(id);
  </script>
</body>
</html>
